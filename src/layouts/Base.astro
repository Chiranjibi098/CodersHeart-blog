---
import Header from '@components/Header.astro';
import Hero from '@components/Hero.astro';
import FeaturedVideos from '@components/FeaturedVideos.astro';
import Footer from '@components/Footer.astro';
import config from '@config/config.json';
import { createOgImage } from '@utils/createOgImage';
import GoogleAnalytics from '@components/GoogleAnalytics.astro';

import '@styles/global.css';

import { ViewTransitions } from 'astro:transitions';

export interface Props {
  title?: string;
  meta_title?: string;
  description?: string;
  image?: string;
  noindex?: boolean;
  canonical?: string;
  blogpost?: boolean;
}

const { title, meta_title, description, noindex, blogpost } = Astro.props;

const ogImage = createOgImage({
  title: meta_title ? meta_title : title ? title : config.site.title,
  meta: [config.site.title, config.site.base_url].join(' Â· '),
});
---

<!doctype html>
<html lang={config.site.lang}>
  <head>
    <GoogleAnalytics />
    <script type="text/javascript">
      if (typeof window !== 'undefined') {
        window.dataLayer = window.dataLayer || [];
        function gtag() {
          window.dataLayer.push(arguments);
        }
        gtag('js', new Date());
        gtag('config', 'G-H75PP36701');
      }
    </script>
    <!-- add the following inline script for cookies -->
    <!-- Add the inline script for cookies -->
    <script is:inline>
      document.addEventListener('DOMContentLoaded', function () {
        const consentPopup = document.getElementById('cookie-consent');
        const acceptCookiesButton = document.getElementById('accept-cookies');
        const rejectCookiesButton = document.getElementById('reject-cookies');
    
        function setCookie(name, value, days) {
          const d = new Date();
          d.setTime(d.getTime() + days * 24 * 60 * 60 * 1000);
          const expires = 'expires=' + d.toUTCString();
          document.cookie = name + '=' + value + ';' + expires + ';path=/';
        }
    
        function getCookie(name) {
          const value = `; ${document.cookie}`;
          const parts = value.split(`; ${name}=`);
          if (parts.length === 2) return parts.pop().split(';').shift();
        }
    
        function checkCookieConsent() {
          const consent = getCookie('cookie_consent');
          if (consent === 'accepted' || consent === 'rejected') {
            consentPopup.style.display = 'none';
          } else {
            // Check if the current path is '/'
            if (window.location.pathname === '/') {
              consentPopup.style.display = 'flex';
            } else {
              consentPopup.style.display = 'none';
            }
          }
        }
    
        acceptCookiesButton.onclick = function () {
          setCookie('cookie_consent', 'accepted', 365);
          consentPopup.style.display = 'none';
        };
    
        rejectCookiesButton.onclick = function () {
          setCookie('cookie_consent', 'rejected', 365);
          consentPopup.style.display = 'none';
        };
    
        checkCookieConsent();
      });
    </script>
    
    <!-- favicon -->
    <link rel="shortcut icon" href="/favicons/favicon.ico" />
    <!-- theme meta -->
    <meta name="theme-name" content="bookworm-light-astro" />
    <meta name="msapplication-TileColor" content="#000000" />
    <meta name="theme-color" media="(prefers-color-scheme: light)" content="#fff" />
    <meta name="generator" content={Astro.generator} />
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <!-- responsive meta -->
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />

    <!-- SEO meta tags -->
    <title>{meta_title ? meta_title : title ? title : config.site.title}</title>
    <meta name="title" content={meta_title ? meta_title : title ? title : config.site.title} />
    <meta name="description" content={description ? description : config.metadata.meta_description} />
    <link rel="canonical" href={`${config.site.base_url}/${Astro.url.pathname.replace('/', '')}`} item-prop="url" />
    {noindex && <meta name="robots" content="noindex,nofollow" />}
    <meta name="author" content={config.metadata.meta_author} />
    <meta
      name="keywords"
      content="Coder Heart, development blog, coding tutorials, programming guides, software development, web development, Node.js, JavaScript, Vercel, developers, India"
    />

    <!-- Open Graph meta tags -->
    <meta property="og:title" content={meta_title ? meta_title : title ? title : config.site.title} />
    <meta property="og:description" content={description ? description : config.metadata.meta_description} />
    <meta property="og:type" content="website" />
    <meta property="og:url" content={`${config.site.base_url}/${Astro.url.pathname.replace('/', '')}`} />
    <meta property="og:image" content={ogImage} />
    <meta property="og:site_name" content={config.site.title} />

    <!-- Twitter meta tags -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content={meta_title ? meta_title : title ? title : config.site.title} />
    <meta name="twitter:description" content={description ? description : config.metadata.meta_description} />
    <meta name="twitter:image" content={ogImage} />

    <!-- Additional meta tags for SEO -->
    <meta name="robots" content="index, follow" />
    <meta name="distribution" content="global" />
    <meta name="rating" content="general" />
    <meta name="revisit-after" content="7 days" />
    <meta name="language" content={config.site.lang} />
    <meta name="geo.region" content="IN" />
    <meta name="geo.placename" content="India" />
    <meta name="geo.position" content="20.5937;78.9629" />
    <meta name="ICBM" content="20.5937, 78.9629" />

    <!--AdSense -->
    <meta name="google-adsense-account" content="ca-pub-6290745948063654" />

    <script is:inline src="/registerSW.js"></script>
    <link rel="manifest" href="/manifest.webmanifest" />
    <ViewTransitions />
  </head>
  <body class="bg-white dark:bg-zinc-900/95">
    <Header />
    {!blogpost && <Hero />}
    <main class="mx-auto max-w-screen-lg px-4 py-8 sm:px-6 sm:py-12 lg:px-8">
      <slot />
    </main>
    {!blogpost && config.features.youtube && <FeaturedVideos />}
    <Footer />
    <script>
      // This is a hack to get vite-plugin-pwa to generate a sw.js file.
      // Do not remove this script tag.
    </script>
    <style>
      .card {
        width: 600px;
        height: 220px;
        background-color: rgb(255, 255, 255);
        border-radius: 8px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 20px 30px;
        gap: 13px;
        /* position: relative; */
        overflow: hidden;
        box-shadow: 2px 2px 20px rgba(0, 0, 0, 0.062);
        left: 30%;
        right: 30%;
        bottom: 3%;
      }

      #cookieSvg {
        width: 50px;
      }

      #cookieSvg g path {
        fill: rgb(97, 81, 81);
      }

      .cookieHeading {
        font-size: 1.2em;
        font-weight: 800;
        color: rgb(26, 26, 26);
      }

      .cookieDescription {
        text-align: center;
        font-size: 0.7em;
        font-weight: 600;
        color: rgb(99, 99, 99);
      }

      .cookieDescription a {
        --tw-text-opacity: 1;
        color: rgb(59 130 246);
      }

      .cookieDescription a:hover {
        -webkit-text-decoration-line: underline;
        text-decoration-line: underline;
      }

      .buttonContainer {
        display: flex;
        gap: 20px;
        flex-direction: row;
      }

      .acceptButton {
        width: 80px;
        height: 30px;
        background-color: #ff7777 !important;
        transition-duration: 0.2s !important;
        border: none !important;
        color: rgb(241, 241, 241) !important;
        cursor: pointer !important;
        font-weight: 600 !important;
        border-radius: 20px !important;
        box-shadow:
          0 4px 6px -1px #ff7777,
          0 2px 4px -1px #ff7777 !important;
        transition: all 0.6s ease !important;
      }

      .declineButton {
        width: 80px;
        height: 30px;
        background-color: #dadada !important;
        transition-duration: 0.2s !important;
        color: rgb(46, 46, 46) !important;
        border: none;
        cursor: not-allowed !important;
        font-weight: 600 !important;
        border-radius: 20px !important;
        box-shadow:
          0 4px 6px -1px #bebdbd,
          0 2px 4px -1px #bebdbd !important;
        transition: all 0.6s ease !important;
      }

      .declineButton:hover {
        background-color: #ebebeb;
        box-shadow:
          0 10px 15px -3px #bebdbd,
          0 4px 6px -2px #bebdbd;
        transition-duration: 0.2s;
      }

      .acceptButton:hover {
        background-color: #ff7777;
        box-shadow:
          0 10px 15px -3px #ff7777,
          0 4px 6px -2px #ff7777;
        transition-duration: 0.2s;
      }
      .wrapper-cookies {
        width: 100%;
        height: 100%;
        background-color: rgba(35, 35, 35, 0.562);
        position: fixed;
        z-index: 100;
        top: 0;
        bottom: 0;
        backdrop-filter: blur(2px);
        overflow-y: hidden !important;
      }
    </style>

    <!-- Cookie Consent Popup -->
    <div id="cookie-consent" class="wrapper-cookies" id="cookieConsentPopup">
      <div
        class="card fixed bottom-0 left-0 right-0 z-50 flex items-center justify-between bg-white p-4 shadow-md dark:bg-zinc-900"
      >
        <svg xml:space="preserve" viewBox="0 0 122.88 122.25" y="0px" x="0px" id="cookieSvg" version="1.1"
          ><g
            ><path
              d="M101.77,49.38c2.09,3.1,4.37,5.11,6.86,5.78c2.45,0.66,5.32,0.06,8.7-2.01c1.36-0.84,3.14-0.41,3.97,0.95 c0.28,0.46,0.42,0.96,0.43,1.47c0.13,1.4,0.21,2.82,0.24,4.26c0.03,1.46,0.02,2.91-0.05,4.35h0v0c0,0.13-0.01,0.26-0.03,0.38 c-0.91,16.72-8.47,31.51-20,41.93c-11.55,10.44-27.06,16.49-43.82,15.69v0.01h0c-0.13,0-0.26-0.01-0.38-0.03 c-16.72-0.91-31.51-8.47-41.93-20C5.31,90.61-0.73,75.1,0.07,58.34H0.07v0c0-0.13,0.01-0.26,0.03-0.38 C1,41.22,8.81,26.35,20.57,15.87C32.34,5.37,48.09-0.73,64.85,0.07V0.07h0c1.6,0,2.89,1.29,2.89,2.89c0,0.4-0.08,0.78-0.23,1.12 c-1.17,3.81-1.25,7.34-0.27,10.14c0.89,2.54,2.7,4.51,5.41,5.52c1.44,0.54,2.2,2.1,1.74,3.55l0.01,0 c-1.83,5.89-1.87,11.08-0.52,15.26c0.82,2.53,2.14,4.69,3.88,6.4c1.74,1.72,3.9,3,6.39,3.78c4.04,1.26,8.94,1.18,14.31-0.55 C99.73,47.78,101.08,48.3,101.77,49.38L101.77,49.38z M59.28,57.86c2.77,0,5.01,2.24,5.01,5.01c0,2.77-2.24,5.01-5.01,5.01 c-2.77,0-5.01-2.24-5.01-5.01C54.27,60.1,56.52,57.86,59.28,57.86L59.28,57.86z M37.56,78.49c3.37,0,6.11,2.73,6.11,6.11 s-2.73,6.11-6.11,6.11s-6.11-2.73-6.11-6.11S34.18,78.49,37.56,78.49L37.56,78.49z M50.72,31.75c2.65,0,4.79,2.14,4.79,4.79 c0,2.65-2.14,4.79-4.79,4.79c-2.65,0-4.79-2.14-4.79-4.79C45.93,33.89,48.08,31.75,50.72,31.75L50.72,31.75z M119.3,32.4 c1.98,0,3.58,1.6,3.58,3.58c0,1.98-1.6,3.58-3.58,3.58s-3.58-1.6-3.58-3.58C115.71,34.01,117.32,32.4,119.3,32.4L119.3,32.4z M93.62,22.91c2.98,0,5.39,2.41,5.39,5.39c0,2.98-2.41,5.39-5.39,5.39c-2.98,0-5.39-2.41-5.39-5.39 C88.23,25.33,90.64,22.91,93.62,22.91L93.62,22.91z M97.79,0.59c3.19,0,5.78,2.59,5.78,5.78c0,3.19-2.59,5.78-5.78,5.78 c-3.19,0-5.78-2.59-5.78-5.78C92.02,3.17,94.6,0.59,97.79,0.59L97.79,0.59z M76.73,80.63c4.43,0,8.03,3.59,8.03,8.03 c0,4.43-3.59,8.03-8.03,8.03s-8.03-3.59-8.03-8.03C68.7,84.22,72.29,80.63,76.73,80.63L76.73,80.63z M31.91,46.78 c4.8,0,8.69,3.89,8.69,8.69c0,4.8-3.89,8.69-8.69,8.69s-8.69-3.89-8.69-8.69C23.22,50.68,27.11,46.78,31.91,46.78L31.91,46.78z M107.13,60.74c-3.39-0.91-6.35-3.14-8.95-6.48c-5.78,1.52-11.16,1.41-15.76-0.02c-3.37-1.05-6.32-2.81-8.71-5.18 c-2.39-2.37-4.21-5.32-5.32-8.75c-1.51-4.66-1.69-10.2-0.18-16.32c-3.1-1.8-5.25-4.53-6.42-7.88c-1.06-3.05-1.28-6.59-0.61-10.35 C47.27,5.95,34.3,11.36,24.41,20.18C13.74,29.69,6.66,43.15,5.84,58.29l0,0.05v0h0l-0.01,0.13v0C5.07,73.72,10.55,87.82,20.02,98.3 c9.44,10.44,22.84,17.29,38,18.1l0.05,0h0v0l0.13,0.01h0c15.24,0.77,29.35-4.71,39.83-14.19c10.44-9.44,17.29-22.84,18.1-38l0-0.05 v0h0l0.01-0.13v0c0.07-1.34,0.09-2.64,0.06-3.91C112.98,61.34,109.96,61.51,107.13,60.74L107.13,60.74z M116.15,64.04L116.15,64.04 L116.15,64.04L116.15,64.04z M58.21,116.42L58.21,116.42L58.21,116.42L58.21,116.42z"
            ></path></g
          ></svg
        >
        <p class="cookieHeading">We use cookies.</p>
        <p class="cookieDescription">
          We use cookies to ensure that we give you the best experience on our website. <br /><a href="#"
            >Read cookies policies</a
          >.
        </p>

        <div class="buttonContainer">
          <button id="accept-cookies" class="acceptButton" onclick="acceptCookies()">Allow</button>
          <button id="reject-cookies" class="declineButton" onclick="acceptCookies()">Decline</button>
        </div>
      </div>
    </div>

    <!-- <div
      id="cookie-consent"
      class="fixed bottom-0 left-0 right-0 z-50 flex items-center justify-between bg-white p-4 shadow-md dark:bg-zinc-900"
    >
      <p class="text-sm text-gray-800 dark:text-gray-200">
        We use cookies to improve your experience on our site. By accepting, you agree to our use of cookies.
      </p>
      <div>
        <button id="accept-cookies" class="rounded bg-blue-500 px-4 py-2 text-white">Accept</button>
        <button id="reject-cookies" class="ml-2 rounded bg-gray-500 px-4 py-2 text-white">Reject</button>
      </div>
    </div> -->
  </body>
</html>
